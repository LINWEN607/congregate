image: python:2.7.15-jessie

stages:
  - update-info
  - build

update readme:
  stage: update-info
  script:
    - apt-get update
    - apt-get install -y jq
    - mkdir data
    - echo $Dummy_config
    - echo $Dummy_config | jq . > data/config.json
    - cat data/config.json
    - pip install pipenv
    - pipenv install
    - pipenv run python update-readme.py
  only:
    - master

archive project:
  stage: build
  script:
    - pip install pipenv
    - pipenv install
    - pipenv run dnd install
    - mkdir congregate-${CI_COMMIT_TAG}
    - cp -r aws congregate-${CI_COMMIT_TAG}
    - cp -r cli congregate-${CI_COMMIT_TAG}
    - cp -r helpers congregate-${CI_COMMIT_TAG}
    - cp -r migration congregate-${CI_COMMIT_TAG}
    - cp -r js-packages congregate-${CI_COMMIT_TAG}
    - cp *.py congregate-${CI_COMMIT_TAG}
    - cp congregate congregate-${CI_COMMIT_TAG}
    - cp Pipfile* congregate-${CI_COMMIT_TAG}
    - tar -czvf congregate-${CI_COMMIT_TAG}.tar.gz congregate-${CI_COMMIT_TAG}
  artifacts:
    paths:
      - congregate-${CI_COMMIT_TAG}.tar.gz
  only:
    - tags


